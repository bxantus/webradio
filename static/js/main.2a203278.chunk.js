(this["webpackJsonpwebradio-react"]=this["webpackJsonpwebradio-react"]||[]).push([[0],{18:function(t,e,n){t.exports=n(26)},23:function(t,e,n){},26:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(14),s=n.n(i),o=(n(23),n(1)),c=n.n(o),u=n(3),l=n(2),h=n(4),p=n(5),f=n(6),v=n(16);function d(t){return{name:t.name,id:t.stationuuid,tags:t.tags,country:t.country,language:t.language,icon:t.favicon,votes:t.votes,codec:t.codec,bitrate:t.bitrate}}var m=function(){function t(e){Object(l.a)(this,t),this.query=void 0,this.offset=0,this.results=[],this.query=e,void 0==this.query.limit&&(this.query.limit=20)}return Object(h.a)(t,[{key:"search",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,a,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(w,"/stations/search?name=").concat(this.query.name,"&order=votes&reverse=true&limit=").concat(this.query.limit,"&offset=").concat(this.offset),t.next=3,fetch(n).then((function(t){return t.json()}));case 3:a=t.sent,r=a.map(d),(e=this.results).push.apply(e,Object(v.a)(r));case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}();function b(t){return y.apply(this,arguments)}function y(){return(y=Object(u.a)(c.a.mark((function t(e){var n,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(w,"/url/").concat(e.id),t.next=3,fetch(n).then((function(t){return t.json()}));case 3:if(!(a=t.sent)||!a.ok){t.next=8;break}return t.abrupt("return",a.url);case 8:return t.abrupt("return",void 0);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){return k.apply(this,arguments)}function k(){return(k=Object(u.a)(c.a.mark((function t(e){var n,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(w,"/stations/byuuid/").concat(e.id),t.next=3,fetch(n).then((function(t){return t.json()}));case 3:if(!(a=t.sent)||!a[0]){t.next=6;break}return t.abrupt("return",d(a[0]));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(c.a.mark((function t(e){var n,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(w,"/vote/").concat(e.id),t.prev=1,t.next=4,fetch(n);case 4:if(!(a=t.sent).ok){t.next=12;break}return t.next=8,a.json();case 8:return a=t.sent,t.abrupt("return",a.ok);case 12:return t.abrupt("return",!1);case 13:t.next=18;break;case 15:return t.prev=15,t.t0=t.catch(1),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}var w="https://de1.api.radio-browser.info/json";function j(t){return void 0==t.codec||void 0==t.bitrate}function E(t){return O.apply(this,arguments)}function O(){return(O=Object(u.a)(c.a.mark((function t(e){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(e);case 2:if(!(n=t.sent)){t.next=7;break}return e.codec=n.codec,e.bitrate=n.bitrate,t.abrupt("return",!0);case 7:return t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var C,N=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var t=this,e=this.props.stations;return e?e.map((function(e){return r.a.createElement("div",{className:"clickable",onClick:function(){var n,a;return null===(n=t.props)||void 0===n||null===(a=n.onStationSelected)||void 0===a?void 0:a.call(n,e)},key:e.id},r.a.createElement("div",{className:"flexible horizontal station-header"},r.a.createElement("h3",null,e.name),r.a.createElement("span",null,e.votes)),r.a.createElement("div",null,e.tags),r.a.createElement("div",{className:"flexible horizontal"},r.a.createElement("span",{className:"flex1"},e.country),r.a.createElement("span",{className:"bold codec"},e.codec," "),r.a.createElement("span",null,e.bitrate," kbps")),r.a.createElement("hr",null))})):null}}]),n}(r.a.Component),P=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).searchTimer=void 0,a.searchList=void 0,a.state={search:C,searching:!1},a.searchList=r.a.createRef(),a}return Object(h.a)(n,[{key:"searchTextChanged",value:function(){var t=Object(u.a)(c.a.mark((function t(e){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.target.value,this.scheduleSearch(n);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"scheduleSearch",value:function(){var t=Object(u.a)(c.a.mark((function t(e){var n=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.searchTimer=clearTimeout(this.searchTimer),this.searchTimer=setTimeout(Object(u.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new m({name:e}),C=a,n.setState({searching:!0}),t.next=5,a.search();case 5:n.searchList.current&&(n.searchList.current.scrollTop=0),n.setState({search:a,searching:!1});case 7:case"end":return t.stop()}}),t)}))),400);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t,e,n,a=this,i=this.state.search;i&&(n=i.results);var s=this.state.searching?r.a.createElement("span",{className:"loading"},"Searching..."):void 0;return r.a.createElement("div",{className:"search flexible vertical "+(null!==(t=this.props.className)&&void 0!==t?t:"")},r.a.createElement("div",{className:"flexible horizontal"},r.a.createElement("input",{className:"flex1",defaultValue:i?i.query.name:"",onInput:function(t){a.searchTextChanged(t)}}),s),r.a.createElement("div",{ref:this.searchList,className:"results scrollable"},r.a.createElement(N,{stations:n,onStationSelected:null===(e=this.props)||void 0===e?void 0:e.onStationSelected})))}}]),n}(r.a.Component),_=n(7),I=n(17),T=n(15);function D(){return q.apply(this,arguments)}function q(){return(q=Object(u.a)(c.a.mark((function t(){var e,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=localStorage.getItem("lastPlayed"))){t.next=7;break}if(!j(n=JSON.parse(e))){t.next=6;break}return t.next=6,E(n);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t){localStorage.setItem("lastPlayed",JSON.stringify(t))}var L=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).name="LoadError",a}return n}(Object(I.a)(Error)),M=function(){function t(){Object(l.a)(this,t),this.player=void 0,this.station=void 0,this.statusEmitter=[],this.loading=void 0,this._volume=100}return Object(h.a)(t,[{key:"setStation",value:function(){var t=Object(u.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.player&&(this.player.off(),this.player.stop(),this.player.unload(),this.player=void 0),this.fireStatusChange("load","station"),this.station=e,F(e),this.loading=this.loadPlayer(e),t.abrupt("return",this.loading);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadPlayer",value:function(){var t=Object(u.a)(c.a.mark((function t(e){var n,a,r=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(e);case 2:if(a=t.sent,this.loading=void 0,a){t.next=7;break}throw this.fireStatusChange("error","cannot resolve station url"),new L("cannot resolve station url");case 7:if((null===(n=this.station)||void 0===n?void 0:n.id)!=e.id){t.next=19;break}this.player&&(this.player.off(),this.player.unload()),this.player=new T.Howl({src:a,autoplay:!1,html5:!0,preload:!1}),this.fireStatusChange("stop"),this.player.on("load",(function(){return r.fireStatusChange("load","start playing")})),this.player.on("play",(function(){return r.fireStatusChange("play")})),this.player.on("stop",(function(){return r.fireStatusChange("stop")})),this.player.on("pause",(function(){return r.fireStatusChange("stop")})),this.player.on("loaderror",(function(t,e){return r.fireStatusChange("error","loading the stream failed: "+e)})),this.player.on("playerror",(function(t,e){return r.fireStatusChange("error","playback error: "+e)})),t.next=20;break;case 19:throw new L("changed stations while loading");case 20:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"play",value:function(){var t=Object(u.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.loading){t.next=4;break}return t.next=4,this.loading;case 4:t.next=13;break;case 6:if(t.prev=6,t.t0=t.catch(0),!(t.t0 instanceof L)){t.next=12;break}return t.abrupt("return");case 12:throw t.t0;case 13:this.player&&!this.player.playing()&&("unloaded"==this.player.state()&&this.fireStatusChange("load","stream"),this.player.volume(this._volume/100),this.player.play());case 14:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.player&&(this.player.stop(),this.player.unload())}},{key:"fireStatusChange",value:function(t,e){var n,a=Object(_.a)(this.statusEmitter);try{for(a.s();!(n=a.n()).done;){(0,n.value)(t,e)}}catch(r){a.e(r)}finally{a.f()}}},{key:"onStatusChanged",value:function(t){return this.statusEmitter.push(t),t}},{key:"offStatusChanged",value:function(t){var e=this.statusEmitter.findIndex((function(e){return t==e}));e>=0&&this.statusEmitter.splice(e,1)}},{key:"volume",set:function(t){this._volume=t,this.player&&this.player.volume(t/100)}}]),t}(),U=new(function(){function t(){Object(l.a)(this,t),this.stations=[],this.updateCbs=[]}return Object(h.a)(t,[{key:"add",value:function(t){this.isFavorite(t)||(this.stations.push(t),this.save())}},{key:"remove",value:function(t){var e=this.stations.findIndex((function(e){return e.id==t.id}));e>=0&&(this.stations.splice(e,1),this.save())}},{key:"isFavorite",value:function(t){return void 0!=this.stations.find((function(e){return e.id==t.id}))}},{key:"save",value:function(){localStorage.setItem("stations",JSON.stringify(this.stations)),this.changed()}},{key:"load",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,a,r,i,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=localStorage.getItem("stations"))){t.next=15;break}n=JSON.parse(e),a=[],r=Object(_.a)(n);try{for(r.s();!(i=r.n()).done;)j(s=i.value)&&a.push(E(s))}catch(o){r.e(o)}finally{r.f()}if(t.prev=6,!a.length){t.next=12;break}return t.next=10,Promise.all(a);case 10:this.stations=n,this.save();case 12:return t.prev=12,this.stations!=n&&(this.stations=n,this.changed()),t.finish(12);case 15:case"end":return t.stop()}}),t,this,[[6,,12,15]])})));return function(){return t.apply(this,arguments)}}()},{key:"onUpdated",value:function(t){return this.updateCbs.push(t),t}},{key:"changed",value:function(){var t,e=Object(_.a)(this.updateCbs);try{for(e.s();!(t=e.n()).done;){(0,t.value)()}}catch(n){e.e(n)}finally{e.f()}}},{key:"list",get:function(){return this.stations}}]),t}()),V=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).valueChangeSub=void 0,t.posStartDrag=0,t.valStart=0,t.sliderBg=r.a.createRef(),t.dragging=!1,t}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.valueChangeSub=this.model.subscribe("value",(function(){t.setState({})}))}},{key:"componentWillUnmount",value:function(){this.valueChangeSub&&this.valueChangeSub.unsubscribe()}},{key:"onPointerMove",value:function(t){if(this.dragging&&this.sliderBg.current){var e=this.sliderBg.current.clientWidth,n=t.clientX-this.posStartDrag;if(e>0){var a=n*(this.model.max-this.model.min)/e;this.model.val=this.valStart+a}}}},{key:"onPointerDown",value:function(t){this.posStartDrag=t.clientX,this.valStart=this.model.val,t.target.setPointerCapture(t.pointerId),this.dragging=!0}},{key:"onPointerUp",value:function(t){this.dragging=!1}},{key:"render",value:function(){var t=this,e=this.model,n=100*(e.val-e.min)/(e.max-e.min);return r.a.createElement("div",{className:"slider bg",ref:this.sliderBg},r.a.createElement("div",{style:{left:"".concat(n,"%"),top:"50%",width:0,height:0,position:"absolute"}},r.a.createElement("span",{className:"thumb",onPointerDown:function(e){return t.onPointerDown(e)},onPointerMove:function(e){return t.onPointerMove(e)},onPointerUp:function(e){return t.onPointerUp(e)}})))}},{key:"model",get:function(){return this.props.model}}]),n}(r.a.Component),A=function(){function t(){Object(l.a)(this,t),this.subs=new Map}return Object(h.a)(t,[{key:"add",value:function(t,e){var n=this.subs.get(t)||[];0==n.length&&this.subs.set(t,n);var a={onChange:e};return n.push(a),{unsubscribe:function(){var t=n.findIndex((function(t){return t==a}));t>=0&&n.splice(t)}}}},{key:"notifyFor",value:function(t,e){var n=this.subs.get(t);if(n){var a,r=Object(_.a)(n);try{for(r.s();!(a=r.n()).done;){a.value.onChange(e)}}catch(i){r.e(i)}finally{r.f()}}}}]),t}(),J=function(){function t(){Object(l.a)(this,t),this._min=0,this._max=100,this._val=0,this.subs=new A}return Object(h.a)(t,[{key:"setRange",value:function(t,e){if(void 0==t&&(t=this._min),void 0==e&&(e=this._max),t>=e)throw new Error("Invalid range! (min < max) should hold. Got: ".concat(t," >= ").concat(e));this._min=t,this._max=e,this._val<t?this.updateValue(t):this._val>e&&this.updateValue(e)}},{key:"subscribe",value:function(t,e){return this.subs.add(t,e)}},{key:"updateValue",value:function(t){this._val!=t&&(this._val=t,this.subs.notifyFor("value",t))}},{key:"val",get:function(){return this._val},set:function(t){t<this._min?t=this._min:t>this._max&&(t=this._max),this.updateValue(t)}},{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}}]),t}(),B=new M,R=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))).state={status:"stop",voting:!1},t.statusChangeId=void 0,t.volume=new J,t}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.statusChangeId=B.onStatusChanged((function(e,n){var a;B.station&&(null===(a=t.props.station)||void 0===a?void 0:a.id)==B.station.id&&t.setState({status:e,detail:n})})),this.volume.val=75,this.volume.subscribe("value",(function(t){return B.volume=t}))}},{key:"componentWillUnmount",value:function(){this.statusChangeId&&B.offStatusChanged(this.statusChangeId)}},{key:"togglePlayback",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.props.station){t.next=2;break}return t.abrupt("return");case 2:if("play"==this.getPlayStatus()){t.next=18;break}if(t.prev=4,this.setState({status:"load",detail:void 0}),(null===(e=B.station)||void 0===e?void 0:e.id)==this.props.station.id){t.next=9;break}return t.next=9,B.setStation(this.props.station);case 9:B.play(),t.next=16;break;case 12:if(t.prev=12,t.t0=t.catch(4),t.t0 instanceof L){t.next=16;break}throw t.t0;case 16:t.next=19;break;case 18:B.stop();case 19:case"end":return t.stop()}}),t,this,[[4,12]])})));return function(){return t.apply(this,arguments)}}()},{key:"getPlayStatus",value:function(){var t,e=this.state.status;return this.props.station&&this.props.station.id!=(null===(t=B.station)||void 0===t?void 0:t.id)&&(e="stop"),e}},{key:"getPlayDetail",value:function(){var t;return this.props.station&&this.props.station.id!=(null===(t=B.station)||void 0===t?void 0:t.id)?void 0:this.state.detail}},{key:"toggleFavorite",value:function(){var t=this.props.station;t&&(U.isFavorite(t)?U.remove(t):U.add(t),this.setState({}))}},{key:"vote",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.props.station){t.next=2;break}return t.abrupt("return");case 2:return this.setState({voting:!0}),t.next=5,x(this.props.station);case 5:return t.sent,t.next=8,g(this.props.station);case 8:(e=t.sent)&&(this.props.station.votes=e.votes),this.setState({voting:!1});case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t,e,n=this,a=this.props.station;if(!a)return null;var i,s=this.getPlayStatus(),o=null!==(e={play:"Stop",stop:"Play",load:"Loading",error:"Error ".concat(null!==(t=this.state.detail)&&void 0!==t?t:"")}[s])&&void 0!==e?e:"Error",c=this.getPlayDetail();return c&&(i=r.a.createElement("span",null,c)),r.a.createElement("div",{className:this.props.className},r.a.createElement("h2",null,a.name),r.a.createElement("p",null,"in: ",a.country),r.a.createElement("p",null,"tags: ",a.tags),r.a.createElement("p",null,r.a.createElement("span",{className:"bold codec"},a.codec),a.bitrate," kbps"),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(t){return n.togglePlayback()}},o)," ",i),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return n.toggleFavorite()}},U.isFavorite(a)?"Remove from favorites":"Add to favorites"),r.a.createElement("button",{onClick:function(){return n.vote()},disabled:this.state.voting},this.state.voting?"Voting...":"Vote!"),r.a.createElement("span",null,a.votes," votes")),r.a.createElement(V,{model:this.volume}))}}]),n}(r.a.Component),z=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"about "+this.props.className},r.a.createElement("h2",null,"About"),r.a.createElement("p",null,"Open source webradio implementation using React."),r.a.createElement("p",null,"Uses the api provided by ",r.a.createElement("a",{href:"http://www.radio-browser.info"},"http://www.radio-browser.info")),r.a.createElement("p",null,"If you find any issues, or have feature requests please report them at the project's github page: ",r.a.createElement("a",{href:"https://github.com/bxantus/webradio"},"https://github.com/bxantus/webradio")),r.a.createElement("hr",null),r.a.createElement("h3",null,"Link for mobile devices:"),r.a.createElement("img",{src:"/webradio/address_qr.png"}))}}]),n}(r.a.Component),W=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).state={selectedTab:"Search"},U.load(),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return U.onUpdated((function(){n.setState({})})),t.next=3,D();case 3:(e=t.sent)&&(B.setStation(e),this.stationSelected(e));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"changeTab",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState({selectedTab:t.title}),e&&this.setState({selectedStation:B.station})}},{key:"stationSelected",value:function(t){this.setState({selectedStation:t}),this.changeTab(this.tabs[2],!1)}},{key:"render",value:function(){var t=this,e=this.tabs,n=this.state.selectedTab,a=e.find((function(t){return t.title===n})),i=e.map((function(e){return r.a.createElement("span",{className:e===a?"tab selected":"tab",key:e.title,onClick:function(n){return t.changeTab(e)}},e.title)})),s=e.map((function(t){return t.content(t==a?"visible":"hidden")}));return r.a.createElement("div",{className:"radio-App flexible vertical"},r.a.createElement("div",{className:"tabs"},i),s)}},{key:"tabs",get:function(){var t=this;return[{title:"Search",content:function(e){return r.a.createElement(P,{className:e,onStationSelected:function(e){return t.stationSelected(e)}},"Search content")}},{title:"Favorites",content:function(e){return r.a.createElement("div",{className:"scrollable "+e},r.a.createElement(N,{stations:U.list,onStationSelected:function(e){return t.stationSelected(e)}}))}},{title:"Play",content:function(e){return r.a.createElement(R,{className:e,station:t.state.selectedStation})}},{title:"About",content:function(t){return r.a.createElement(z,{className:t})}}]}}]),n}(r.a.Component);s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(W,null,"my text")),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.2a203278.chunk.js.map